"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[5904],{3905:(t,e,n)=>{n.d(e,{Zo:()=>l,kt:()=>d});var o=n(7294);function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function a(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function c(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?a(Object(n),!0).forEach((function(e){r(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function s(t,e){if(null==t)return{};var n,o,r=function(t,e){if(null==t)return{};var n,o,r={},a=Object.keys(t);for(o=0;o<a.length;o++)n=a[o],e.indexOf(n)>=0||(r[n]=t[n]);return r}(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(o=0;o<a.length;o++)n=a[o],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}var p=o.createContext({}),i=function(t){var e=o.useContext(p),n=e;return t&&(n="function"==typeof t?t(e):c(c({},e),t)),n},l=function(t){var e=i(t.components);return o.createElement(p.Provider,{value:e},t.children)},u={inlineCode:"code",wrapper:function(t){var e=t.children;return o.createElement(o.Fragment,{},e)}},h=o.forwardRef((function(t,e){var n=t.components,r=t.mdxType,a=t.originalType,p=t.parentName,l=s(t,["components","mdxType","originalType","parentName"]),h=i(n),d=r,f=h["".concat(p,".").concat(d)]||h[d]||u[d]||a;return n?o.createElement(f,c(c({ref:e},l),{},{components:n})):o.createElement(f,c({ref:e},l))}));function d(t,e){var n=arguments,r=e&&e.mdxType;if("string"==typeof t||r){var a=n.length,c=new Array(a);c[0]=h;var s={};for(var p in e)hasOwnProperty.call(e,p)&&(s[p]=e[p]);s.originalType=t,s.mdxType="string"==typeof t?t:r,c[1]=s;for(var i=2;i<a;i++)c[i]=n[i];return o.createElement.apply(null,c)}return o.createElement.apply(null,n)}h.displayName="MDXCreateElement"},5220:(t,e,n)=>{n.r(e),n.d(e,{assets:()=>p,contentTitle:()=>c,default:()=>u,frontMatter:()=>a,metadata:()=>s,toc:()=>i});var o=n(7462),r=(n(7294),n(3905));const a={},c=void 0,s={unversionedId:"main/context/ContractAppContext",id:"main/context/ContractAppContext",title:"ContractAppContext",description:"How to use ContractAppContext",source:"@site/docs/main/context/ContractAppContext.mdx",sourceDirName:"main/context",slug:"/main/context/ContractAppContext",permalink:"/eth-ui/docs/main/context/ContractAppContext",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/main/context/ContractAppContext.mdx",tags:[],version:"current",frontMatter:{},sidebar:"overview",previous:{title:"useTokenBalance",permalink:"/eth-ui/docs/main/hooks/useTokenBalance"},next:{title:"EthersAppContext",permalink:"/eth-ui/docs/main/context/EthersAppContext"}},p={},i=[{value:"How to use <code>ContractAppContext</code>",id:"how-to-use-contractappcontext",level:2},{value:"\ud83d\udea9 1. Generating types for your contract",id:"-1-generating-types-for-your-contract",level:3},{value:"How to use <code>eth-sdk</code> for external contracts",id:"how-to-use-eth-sdk-for-external-contracts",level:4},{value:"How to use Hardhat with typechain",id:"how-to-use-hardhat-with-typechain",level:4},{value:"\ud83d\udea9 2. Creating the context with <code>contractsContextFactory</code>",id:"-2-creating-the-context-with-contractscontextfactory",level:3},{value:"\ud83d\udea9 3. Using hooks to get your contracts",id:"-3-using-hooks-to-get-your-contracts",level:3}],l={toc:i};function u(t){let{components:e,...n}=t;return(0,r.kt)("wrapper",(0,o.Z)({},l,n,{components:e,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"how-to-use-contractappcontext"},"How to use ",(0,r.kt)("inlineCode",{parentName:"h2"},"ContractAppContext")),(0,r.kt)("h3",{id:"-1-generating-types-for-your-contract"},"\ud83d\udea9 1. Generating types for your contract"),(0,r.kt)("p",null,"First, you'll have to generate your contract types for Hardhat and external contracts."),(0,r.kt)("p",null,"To do this, you can use ",(0,r.kt)("inlineCode",{parentName:"p"},"eth-sdk")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"typechain with hardhat")," to generate your contracts. Then add them to a folder, such as ",(0,r.kt)("inlineCode",{parentName:"p"},"generated/contract-types"),"."),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"You can see how this is done in the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/scaffold-eth/scaffold-eth-typescript"},"scaffold-eth-typescript")," repo")),(0,r.kt)("h4",{id:"how-to-use-eth-sdk-for-external-contracts"},"How to use ",(0,r.kt)("inlineCode",{parentName:"h4"},"eth-sdk")," for external contracts"),(0,r.kt)("p",null,"Scaffold-eth-typescript uses ",(0,r.kt)("inlineCode",{parentName:"p"},"eth-sdk")," to generate types and an ABI for use by external contracts."),(0,r.kt)("p",null,"\ud83d\udcdd Note: This would be a dev dependency on your project."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"a config of ",(0,r.kt)("inlineCode",{parentName:"li"},"{contractNames: address}")," ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/scaffold-eth/scaffold-eth-typescript/blob/next/packages/vite-app-ts/src/config/externalContractsConfig.ts"},"externalContractConfig.ts")),(0,r.kt)("li",{parentName:"ul"},"a config for ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/scaffold-eth/scaffold-eth-typescript/blob/next/packages/vite-app-ts/scripts/eth-sdk-config.ts.bak"},"eth-sdk-config.ts")),(0,r.kt)("li",{parentName:"ul"},"and calling the ",(0,r.kt)("inlineCode",{parentName:"li"},"eth-sdk")," with the folder of your config file as a parameter e.g. ",(0,r.kt)("inlineCode",{parentName:"li"},"yarn eth-sdk -p ./src/generated"))),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"You can learn more at the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/dethcrypto/eth-sdk"},"eth-sdk Github"))),(0,r.kt)("h4",{id:"how-to-use-hardhat-with-typechain"},"How to use Hardhat with typechain"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Check out the excellent ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/dethcrypto/TypeChain"},"typechain docs"),".\nYou can also find an example in scaffold-eth-typescript ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/scaffold-eth/scaffold-eth-typescript/blob/next/packages/hardhat-ts/hardhat.config.ts"},"hardhat.config.ts"),".")),(0,r.kt)("h3",{id:"-2-creating-the-context-with-contractscontextfactory"},"\ud83d\udea9 2. Creating the context with ",(0,r.kt)("inlineCode",{parentName:"h3"},"contractsContextFactory")),(0,r.kt)("p",null,"You need to create a config that returns a config of your contracts. This would be heterogenous key-value pair. Each value is generated by the helper functions in eth-hooks."),(0,r.kt)("p",null,"For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"// a function that generates the config. Note that your types have to exist already!\nexport const contractConnectorConfig = () => {\n  try {\n    const result = {\n      // \ud83d\ude4b\ud83c\udffd\u200d\u2642\ufe0f Add your hadrdhat contracts here\n      YourContract: createConnectorForHardhatContract(\n        'YourContract',\n        hardhatContracts.YourContract__factory,\n        hardhatContractsJson\n      ),\n\n      // \ud83d\ude4b\ud83c\udffd\u200d\u2642\ufe0f Add your external contracts here, make sure to define the address in `externalContractsConfig.ts`\n      DAI: createConnectorForExternalContract('DAI', externalContracts.DAI__factory, externalContractsAddressMap),\n      UNI: createConnectorForExternalContract('UNI', externalContracts.UNI__factory, externalContractsAddressMap),\n\n      // \ud83d\ude4b\ud83c\udffd\u200d\u2642\ufe0f Add your external abi here (unverified contracts)`\n      // DAI: createConnectorForExternalAbi('DAI', { 1: {address: 'xxxx'}}, abi),\n    } as const;\n\n    return result;\n  } catch (e) {\n    console.error(\n      '\u274c contractConnectorConfig: ERROR with loading contracts please run `yarn contracts:build or yarn contracts:rebuild`.  Then run `yarn deploy`!',\n      e\n    );\n  }\n\n  return undefined;\n};\n\n// create a type from the return value of the function above\nexport type TAppConnectorList = NonNullable<ReturnType<typeof contractConnectorConfig>>;\n")),(0,r.kt)("p",null,"Use ",(0,r.kt)("inlineCode",{parentName:"p"},"contractContextFactory")," to create your hooks and context in your app from the above configuration."),(0,r.kt)("p",null,"You can copy the code below and use it to get started fast:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"// you're passing in function `contractConnectorConfig` from above into the factory.  You then have to use the type we defined to type the factory outputs.\nexport const {\n  ContractsAppContext,\n  useAppContractsActions,\n  useAppContracts,\n  useLoadAppContracts,\n  useConnectAppContracts,\n} = contractsContextFactory<\n  /* the contractNames (keys) in config output */\n  keyof TAppConnectorList,\n  /* the type of the config output  */\n  TAppConnectorList,\n  /* A type that infers the value of each contractName: contract pair*/\n  TTypedContract<keyof TAppConnectorList, TAppConnectorList>\n>(contractConnectorConfig);\n")),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"See scaffold-eth-typescript ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/scaffold-eth/scaffold-eth-typescript/blob/next/packages/vite-app-ts/src/config/contractContext.ts"},"contractContext.tsx")," and ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/scaffold-eth/scaffold-eth-typescript/blob/next/packages/vite-app-ts/src/config/contractConnectorConfig.ts"},"contractConnectorConfig.ts")," for full examples of how to do this")),(0,r.kt)("h3",{id:"-3-using-hooks-to-get-your-contracts"},"\ud83d\udea9 3. Using hooks to get your contracts"),(0,r.kt)("p",null,"Now that you've created the context, you can use hooks in your app."),(0,r.kt)("p",null,"The first step is to load your contracts using the hooks you've created with the factory:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"// \ud83d\udefb load contracts\nuseLoadAppContracts();\n")),(0,r.kt)("p",null,"Next you'll want to connect the contracts:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"// \ud83c\udfed connect to  contracts for current network & signer\nuseConnectAppContracts(asEthersAdaptor(ethersContext));\n\n// \ud83c\udfed connect to contracts for mainnet network & signer\nconst [mainnetAdaptor] = useEthersAdaptorFromProviderOrSigners(mainnetProvider);\nuseConnectAppContracts(mainnetAdaptor);\n")),(0,r.kt)("p",null,"Now you can get typed contracts anywhere in your app:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"const yourContract = useAppContracts('YourContract', ethersContext.chainId);\nconst mainnetDai = useAppContracts('DAI', NETWORKS.mainnet.chainId);\n")),(0,r.kt)("p",null,"And you can do cool stuff like read values from your contracts using the ",(0,r.kt)("inlineCode",{parentName:"p"},"useContractReader")," hook:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"// keep track of a variable from the contract in the local React state:\nconst [purpose, update] = useContractReader(\n  /* the contract */\n  yourContract,\n  /* the contract variable or function to read */\n  yourContract?.purpose,\n  /* the arguments, they are typed tuple */\n  [],\n  /* optional: if you want your contracts to only update on event */\n  yourContract?.filters.SetPurpose()\n);\n")),(0,r.kt)("p",null,"Or like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"// keep track of a variable from the contract in the local React state:\nconst [purpose, update] = useContractReader(\n  /* the contract */\n  yourContract,\n  /* the contract variable or function to read */\n  yourContract?.purpose,\n  /* the arguments, they are typed tuple */\n  [],\n  undefined,\n  /* optional: update every 10 blocks */\n  { blockNumberInterval: 10 }\n);\n")))}u.isMDXComponent=!0}}]);